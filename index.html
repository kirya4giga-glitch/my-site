<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiru OS v33.0 - EXTREME TITAN</title>
    <style>
        :root { 
            --bg: #000; --main: #0A84FF; --txt: #fff; 
            --glass: rgba(255, 255, 255, 0.1); 
            --card: rgba(30, 30, 32, 0.8);
            --red: #FF453A; --green: #32D74B; --orange: #FF9F0A; --purple: #BF5AF2; --gold: #FFD700;
        }
        body.theme-light { --bg: #F2F2F7; --main: #007AFF; --txt: #000; --glass: rgba(255,255,255,0.7); --card: rgba(255,255,255,0.9); }
        body.theme-hacker { --bg: #000; --main: #00ff41; --txt: #00ff41; --glass: rgba(0,255,0,0.05); }
        body.theme-retro { --bg: #ffcfdf; --main: #ff5e7e; --txt: #333; --glass: rgba(255,255,255,0.4); }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: var(--txt); margin: 0; padding: 15px; 
            overflow-x: hidden; transition: background 0.5s; -webkit-font-smoothing: antialiased;
        }

        #special-canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index: -1; }

        .ios-card { 
            background: var(--glass); backdrop-filter: blur(25px) saturate(180%); -webkit-backdrop-filter: blur(25px) saturate(180%);
            padding: 20px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); animation: slideUp 0.5s ease;
        }

        .btn { 
            padding: 14px 20px; background: var(--main); color: #fff; border: none; 
            border-radius: 18px; cursor: pointer; font-weight: 600; font-size: 15px;
            transition: 0.3s cubic-bezier(0.2, 0, 0, 1); display: inline-flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.92); opacity: 0.8; }
        .btn-red { background: var(--red); }
        .btn-gold { background: var(--gold); color: #000; box-shadow: 0 0 15px rgba(255,215,0,0.3); }

        #cList { height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; padding-right: 5px; }
        .msg { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 20px; font-size: 14px; position: relative; border: 1px solid rgba(255,255,255,0.05); }
        .msg-time { font-size: 10px; opacity: 0.4; display: block; margin-top: 4px; }
        .msg-del { position: absolute; right: 10px; top: 10px; color: var(--red); cursor: pointer; font-weight: bold; padding: 5px; }
        
        .top-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; background: rgba(255,255,255,0.03); border-radius: 18px; margin-bottom: 8px; border: 1px solid rgba(255,255,255,0.02); }
        .my-rank { border: 2px solid var(--main); background: rgba(10,132,255,0.1); }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); border-radius: 35px; width: 90%; max-width: 420px; z-index: 9999; padding: 30px; border: 1px solid rgba(255,255,255,0.15); max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9998; backdrop-filter: blur(5px); }
        
        input, select { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 16px; color: var(--txt); width: 100%; box-sizing: border-box; margin-bottom: 12px; font-size: 16px; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 260px; margin: 15px auto; }
        .cell { background: rgba(255,255,255,0.08); height: 80px; display: flex; align-items: center; justify-content: center; font-size: 28px; border-radius: 20px; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .lvl-badge { background: var(--main); color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; vertical-align: middle; }
    </style>
</head>
<body class="theme-dark">

    <canvas id="special-canvas"></canvas>
    <div class="overlay" id="overlay"></div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding: 0 10px;">
        <div>
            <h1 style="margin:0; font-size: 28px; font-weight: 800; letter-spacing: -1px;">Kiru OS <span style="color:var(--main)">v33.0</span></h1>
            <div id="online-tag" style="font-size: 12px; color: var(--green); font-weight: 600;">‚óè Online: 0</div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-gold" onclick="openMod('dailyWin')">üéÅ</button>
            <button class="btn" onclick="openMod('clanWin')">üõ°Ô∏è</button>
            <button class="btn" onclick="openMod('shopWin')">üõí</button>
            <button class="btn" onclick="openMod('sMenu')">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="ios-card" style="text-align:center;">
        <div id="l-bal" style="opacity:0.5; font-size:14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Balance</div>
        <div id="score" style="font-size: 64px; font-weight: 900; margin: 10px 0; letter-spacing: -2px;">0</div>
        <div style="margin-bottom: 20px;">
            <span id="user-lvl" class="lvl-badge">LVL 1</span>
            <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 8px;">
                <div id="exp-bar" style="width: 0%; height: 100%; background: var(--main); border-radius: 3px; transition: 0.3s;"></div>
            </div>
        </div>
        <button class="btn" onclick="doTap(event)" style="width:100%; padding:22px; font-size:20px; border-radius:24px; box-shadow: 0 15px 35px rgba(10,132,255,0.3);">TAP TO EARN</button>
        <div id="topContent" style="margin-top:25px;"></div>
    </div>

    <div class="ios-card">
        <h3 id="l-games" style="margin-top:0;">Entertainment</h3>
        <div id="lobby" style="display:flex; gap:12px;">
            <button class="btn" onclick="startMM('ttt')" style="flex:1;">Tic-Tac-Toe</button>
            <button class="btn" onclick="startMM('chess')" style="flex:1;">Chess</button>
        </div>
        <div id="game-area" style="display:none;">
            <div id="g-status" style="text-align:center; font-weight:700; margin-bottom:15px; color: var(--orange);"></div>
            <div id="board-box"></div>
            <button class="btn btn-red" onclick="quitGame()" style="width:100%; margin-top:15px;">Abandon Game</button>
        </div>
    </div>

    <div class="ios-card">
        <h3 id="l-chat" style="margin-top:0;">Live Chat</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="mInp" placeholder="Type a message..." style="margin-bottom:0;">
            <button class="btn" id="sendBtn" style="width:60px; border-radius:18px;">‚Üí</button>
        </div>
    </div>

    <div id="dailyWin" class="modal">
        <h2>Daily Gift üéÅ</h2>
        <p style="opacity:0.7;">Claim your free coins every 24 hours!</p>
        <div id="daily-timer" style="font-weight:bold; font-size:20px; margin: 20px 0; color: var(--green);">Ready!</div>
        <button class="btn btn-gold" id="claimBtn" onclick="claimDaily()" style="width:100%;">Claim 10,000 üí∞</button>
        <button class="btn" onclick="closeMod('dailyWin')" style="width:100%; margin-top:10px;">Close</button>
    </div>

    <div id="shopWin" class="modal">
        <h2>Premium Shop</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div class="top-item" style="flex-direction:column; text-align:center;">ü§ñ Auto +1<button class="btn" onclick="buy('auto', 5000, 1)">5k</button></div>
            <div class="top-item" style="flex-direction:column; text-align:center;">‚ö° Click +2<button class="btn" onclick="buy('multi', 2000, 2)">2k</button></div>
            <div class="top-item" style="flex-direction:column; text-align:center;">üè≠ Factory +50<button class="btn" onclick="buy('auto', 100000, 50)">100k</button></div>
            <div class="top-item" style="flex-direction:column; text-align:center;">üíé [VIP]<button class="btn" onclick="buy('prefix', 50000, 'VIP')">50k</button></div>
        </div>
        <button class="btn" onclick="closeMod('shopWin')" style="width:100%; margin-top:15px;">Close</button>
    </div>

    <div id="sMenu" class="modal">
        <h3 id="l-set">Settings</h3>
        <p>Language:</p>
        <select id="langSel" onchange="setLang(this.value)">
            <option value="rus">–†—É—Å—Å–∫–∏–π</option>
            <option value="eng">English</option>
            <option value="ukr">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        </select>
        <p>Theme:</p>
        <select onchange="setTheme(this.value)">
            <option value="dark">Dark Mode</option>
            <option value="light">Light Mode</option>
            <option value="hacker">Hacker (Matrix)</option>
            <option value="retro">Retro Pink</option>
        </select>
        <button class="btn btn-gold" onclick="openMod('teaWin')" style="width:100%; margin-top:15px;">‚òï Support Developer</button>
        <button class="btn btn-orange" onclick="openMod('thanksWin')" style="width:100%; margin-top:10px;">üåü Credits</button>
        <button class="btn btn-red" onclick="logout()" style="width:100%; margin-top:10px;">Logout</button>
        <button class="btn" onclick="closeMod('sMenu')" style="width:100%; margin-top:10px;">Exit</button>
    </div>

    <div id="teaWin" class="modal">
        <h3>Support ‚òï</h3>
        <p>–°–∫–∏–Ω—É—Ç—å –±—É–¥—É—â–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É –Ω–∞ —á–∞–π:</p>
        <b style="font-size: 22px; color: var(--main);">+79216274225</b>
        <p>–°–±–µ—Ä–±–∞–Ω–∫ / –°–ë–ü</p>
        <button class="btn" onclick="closeMod('teaWin')" style="width:100%;">Done!</button>
    </div>

    <div id="pCard" class="modal">
        <h2 id="pc-n">User</h2>
        <div id="pc-stats" style="line-height:1.6; opacity:0.8;"></div>
        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button class="btn" onclick="sendMoneyPrompt()">üí∏ Send $</button>
            <button class="btn btn-orange" onclick="admAction('mute')">Mute</button>
            <button class="btn btn-orange" onclick="admAction('unmute')">Unmute</button>
            <button class="btn btn-red" onclick="admAction('reset')">Reset Cash</button>
        </div>
        <button class="btn" onclick="closeMod('pCard')" style="width:100%; margin-top:10px;">Close</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, remove, serverTimestamp, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('k_user_v33'));
        let curLang = 'rus';
        let viewUser = null;
        let canvasInterval = null;

        const langData = {
            rus: { bal: "–ë–∞–ª–∞–Ω—Å", games: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", chat: "–ß–∞—Ç", set: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", buy: "–ö—É–ø–∏—Ç—å" },
            eng: { bal: "Balance", games: "Games", chat: "Chat", set: "Settings", buy: "Buy" },
            ukr: { bal: "–ë–∞–ª–∞–Ω—Å", games: "–†–æ–∑–≤–∞–≥–∏", chat: "–ß–∞—Ç", set: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è", buy: "–ö—É–ø–∏—Ç–∏" }
        };

        async function init() {
            if(!user) {
                let n = prompt("Username:"); let p = prompt("Password:");
                if(!n || !p) return location.reload();
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){
                    if(s.val().password !== p) { alert("Wrong password!"); return location.reload(); }
                    user = {name:n, ...s.val()};
                } else {
                    user = {name:n, password:p, score:0, mult:1, autoclicker:0, exp:0, lvl:1, wins:0, clicks:0, lastDaily:0};
                    await set(ref(db, 'users/'+n), user);
                }
                localStorage.setItem('k_user_v33', JSON.stringify(user));
            }

            const statusRef = ref(db, 'status/' + user.name);
            set(statusRef, true);
            onDisconnect(statusRef).remove();
            onValue(ref(db, 'status'), s => document.getElementById('online-tag').innerText = "‚óè Online: " + (s.size || 0));

            onValue(ref(db, 'users/'+user.name), s => {
                if(s.exists()){
                    user = {name:user.name, ...s.val()};
                    document.getElementById('score').innerText = Math.floor(user.score).toLocaleString();
                    document.getElementById('user-lvl').innerText = "LVL " + (user.lvl || 1);
                    let expNeed = (user.lvl || 1) * 500;
                    let pct = ((user.exp || 0) / expNeed) * 100;
                    document.getElementById('exp-bar').style.width = Math.min(pct, 100) + "%";
                }
            });

            loadTop(); loadChat();
            setInterval(() => { if(user.autoclicker > 0) update(ref(db, 'users/'+user.name), {score: Number(user.score) + user.autoclicker}); }, 1000);
            updateDailyTimer();
        }

        // --- CORE ---
        window.doTap = (e) => {
            let pwr = user.mult || 1;
            let newExp = (user.exp || 0) + 10;
            let newLvl = user.lvl || 1;
            if(newExp >= newLvl * 500) { newExp = 0; newLvl++; alert("LEVEL UP! LVL " + newLvl); }
            
            update(ref(db, 'users/'+user.name), { 
                score: Number(user.score) + pwr, 
                clicks: (user.clicks || 0) + 1,
                exp: newExp,
                lvl: newLvl
            });
        };

        // --- DAILY ---
        window.claimDaily = async () => {
            let now = Date.now();
            if(now - (user.lastDaily || 0) < 86400000) return alert("Wait for timer!");
            await update(ref(db, 'users/'+user.name), { score: user.score + 10000, lastDaily: now });
            updateDailyTimer();
        };

        function updateDailyTimer() {
            let next = (user.lastDaily || 0) + 86400000;
            let diff = next - Date.now();
            const btn = document.getElementById('claimBtn');
            const txt = document.getElementById('daily-timer');
            if(diff <= 0) {
                txt.innerText = "Ready to claim!";
                btn.disabled = false;
            } else {
                btn.disabled = true;
                let h = Math.floor(diff/3600000);
                let m = Math.floor((diff%3600000)/60000);
                txt.innerText = `${h}h ${m}m remaining`;
                setTimeout(updateDailyTimer, 60000);
            }
        }

        // --- CHAT ---
        window.sendMsg = async () => {
            const i = document.getElementById('mInp');
            const val = i.value.trim();
            if(!val) return;
            const s = await get(ref(db, 'users/'+user.name));
            if(s.val().muteUntil > Date.now()) return alert("You are muted!");
            
            await push(ref(db, 'msgs'), {
                n: user.name, 
                t: val, 
                time: serverTimestamp(), 
                pref: s.val().prefix || 'USER', 
                col: s.val().color || '#fff'
            });
            i.value = "";
        };
        document.getElementById('sendBtn').onclick = sendMsg;
        document.getElementById('mInp').onkeypress = (e) => { if(e.key === 'Enter') sendMsg(); };

        function loadChat() {
            onValue(ref(db, 'msgs'), s => {
                const l = document.getElementById('cList'); l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    const t = m.time ? new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '';
                    l.innerHTML += `
                        <div class="msg">
                            <span class="msg-del" onclick="admDelMsg('${d.key}')">√ó</span>
                            <span style="font-size:10px; font-weight:800; color:var(--main)">${m.pref}</span>
                            <b onclick="showP('${m.n}')" style="color:${m.col}">${m.n}</b>: ${m.t}
                            <span class="msg-time">${t}</span>
                        </div>
                    `;
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        // --- SHOP & MONEY ---
        window.buy = async (type, price, val) => {
            if(user.score < price) return alert("Not enough money!");
            let up = { score: user.score - price };
            if(type === 'auto') up.autoclicker = (user.autoclicker || 0) + val;
            if(type === 'multi') up.mult = (user.mult || 1) + val;
            if(type === 'prefix') up.prefix = val;
            await update(ref(db, 'users/'+user.name), up);
            alert("Success!");
        };

        window.sendMoneyPrompt = async () => {
            let amount = parseInt(prompt("Amount to send:"));
            if(isNaN(amount) || amount <= 0 || amount > user.score) return alert("Invalid amount!");
            const target = viewUser;
            const tData = await get(ref(db, 'users/'+target));
            if(tData.exists()){
                await update(ref(db, 'users/'+user.name), { score: user.score - amount });
                await update(ref(db, 'users/'+target), { score: tData.val().score + amount });
                alert("Sent!");
                closeMod('pCard');
            }
        };

        // --- ADMIN ---
        window.admAction = (type) => {
            const pass = prompt("Admin Password:");
            if(pass !== "8070") return alert("Access Denied");
            if(type === 'reset') update(ref(db, 'users/'+viewUser), { score: 0 });
            if(type === 'mute') update(ref(db, 'users/'+viewUser), { muteUntil: Date.now() + 3600000 });
            if(type === 'unmute') update(ref(db, 'users/'+viewUser), { muteUntil: 0 });
        };
        window.admDelMsg = (id) => {
            const pass = prompt("Admin Password:");
            if(pass === "8070") remove(ref(db, 'msgs/'+id));
        };

        // --- THEMES & UI ---
        window.setTheme = (t) => {
            document.body.className = 'theme-' + t;
            if(canvasInterval) clearInterval(canvasInterval);
            const c = document.getElementById('special-canvas');
            const ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            ctx.clearRect(0,0,c.width,c.height);
            if(t === 'hacker') startMatrix(ctx, c);
        };

        function startMatrix(ctx, c) {
            const drops = Array(Math.floor(c.width/15)).fill(1);
            canvasInterval = setInterval(() => {
                ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = "#0f0"; drops.forEach((y, i) => {
                    ctx.fillText(Math.floor(Math.random()*2), i*15, y*15);
                    if(y*15 > c.height && Math.random() > 0.97) drops[i] = 0;
                    drops[i]++;
                });
            }, 50);
        }

        window.showP = async n => {
            viewUser = n; const s = await get(ref(db, 'users/'+n)); const d = s.val();
            document.getElementById('pc-n').innerText = n;
            document.getElementById('pc-stats').innerHTML = `üí∞ Cash: ${Math.floor(d.score)}<br>üèÜ LVL: ${d.lvl || 1}<br>üñ±Ô∏è Total Clicks: ${d.clicks || 0}`;
            openMod('pCard');
        };

        window.loadTop = () => {
            onValue(ref(db, 'users'), s => {
                const c = document.getElementById('topContent'); c.innerHTML = "";
                let a = []; s.forEach(u => a.push({n: u.key, s: u.val().score||0, l: u.val().lvl||1}));
                a.sort((x,y) => y.s - x.s).slice(0,5).forEach((u,i) => {
                    c.innerHTML += `<div class="top-item ${u.n===user.name?'my-rank':''}"><span>#${i+1} ${u.n} (Lvl ${u.l})</span><b>${Math.floor(u.s).toLocaleString()}</b></div>`;
                });
            });
        };

        window.openMod = id => { document.getElementById(id).style.display='block'; document.getElementById('overlay').style.display='block'; };
        window.closeMod = id => { document.getElementById(id).style.display='none'; document.getElementById('overlay').style.display='none'; };
        window.logout = () => { localStorage.clear(); location.reload(); };

        init();
    </script>
</body>
</html>












































