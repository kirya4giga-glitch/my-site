<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiru OS v32.0 - ULTIMATE TITAN</title>
    <style>
        :root { 
            --bg: #000; --main: #0A84FF; --txt: #fff; 
            --glass: rgba(255, 255, 255, 0.08); 
            --card: rgba(28, 28, 30, 0.9);
            --red: #FF453A; --green: #32D74B; --orange: #FF9F0A; --purple: #BF5AF2; --gold: #FFD700;
        }
        /* –¢–ï–ú–´ */
        body.theme-light { --bg: #F2F2F7; --main: #007AFF; --txt: #000; --glass: rgba(0,0,0,0.05); --card: #fff; }
        body.theme-retro { --bg: #ffcfdf; --main: #ff5e7e; --txt: #333; --glass: rgba(255,255,255,0.5); }
        body.theme-hacker { --bg: #000; --main: #00ff41; --txt: #00ff41; --glass: rgba(0,255,0,0.1); }
        body.theme-snow { --bg: #e0f7fa; --main: #0288d1; --txt: #01579b; }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: var(--txt); margin: 0; padding: 15px; 
            overflow-x: hidden; transition: 0.4s;
        }

        /* –°–ù–ï–ñ–ò–ù–ö–ò –ò –ú–ê–¢–†–ò–¶–ê */
        #special-canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index: -1; }

        .ios-card { 
            background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); animation: pop 0.4s ease;
        }

        .btn { 
            padding: 12px 16px; background: var(--main); color: #fff; border: none; 
            border-radius: 14px; cursor: pointer; font-weight: 600; font-size: 14px;
            transition: 0.2s; display: inline-flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); }
        .btn-red { background: var(--red); }
        .btn-gold { background: var(--gold); color: #000; }

        #cList { height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
        .msg { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; font-size: 13px; position: relative; border-left: 3px solid var(--main); }
        
        .top-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 5px; }
        
        /* –ò–ì–†–´ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: 210px; margin: 10px auto; }
        .cell { background: rgba(255,255,255,0.1); height: 70px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; border-radius: 10px; cursor: pointer; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); border-radius: 30px; width: 90%; max-width: 400px; z-index: 9999; padding: 25px; border: 1px solid rgba(255,255,255,0.1); max-height: 85vh; overflow-y: auto; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9998; }
        
        input, select { background: rgba(255,255,255,0.1); border: none; padding: 12px; border-radius: 12px; color: var(--txt); width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        
        .prefix { font-size: 9px; padding: 2px 5px; border-radius: 4px; margin-right: 5px; background: #fff; color: #000; font-weight: 800; }
        @keyframes pop { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="theme-dark">

    <canvas id="special-canvas"></canvas>
    <div class="overlay" id="overlay"></div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <div>
            <h1 style="margin:0; font-size: 22px;">Kiru OS <span style="color:var(--main)">v32.0</span></h1>
            <div id="online-tag" style="font-size: 10px; color: var(--green);">‚óè Online: 0</div>
        </div>
        <div style="display:flex; gap:5px;">
            <button class="btn" onclick="openMod('clanWin')">üõ°Ô∏è</button>
            <button class="btn" onclick="openMod('shopWin')">üõí</button>
            <button class="btn" onclick="openMod('sMenu')">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="ios-card" style="text-align:center;">
        <div id="l-bal" style="opacity:0.6; font-size:12px;">–ë–∞–ª–∞–Ω—Å</div>
        <div id="score" style="font-size: 48px; font-weight: 900; margin: 5px 0;">0</div>
        <div id="l-cl-info" style="font-size: 11px; color: var(--main); margin-bottom:10px;">–ö–ª–∞–Ω: –ù–µ—Ç</div>
        <button class="btn" onclick="doTap(event)" style="width:100%; padding:18px; font-size:18px; border-radius:18px;">–¢–ê–ü</button>
        <div id="topContent" style="margin-top:15px;"></div>
    </div>

    <div class="ios-card">
        <h3 id="l-games">–ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
        <div id="lobby" style="display:flex; gap:10px;">
            <button class="btn" onclick="startMM('ttt')" style="flex:1;">–ö—Ä–µ—Å—Ç–∏–∫–∏</button>
            <button class="btn" onclick="startMM('chess')" style="flex:1;">–®–∞—Ö–º–∞—Ç—ã</button>
        </div>
        <div id="game-area" style="display:none;">
            <div id="g-status" style="text-align:center; font-weight:bold; margin-bottom:10px;"></div>
            <div id="board-box"></div>
            <button class="btn btn-red" onclick="quitGame()" style="width:100%; margin-top:10px;">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="ios-card">
        <h3 id="l-chat">Global Chat</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="mInp" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="btn" onclick="sendMsg()" style="width:50px;">‚Üí</button>
        </div>
    </div>

    <div id="sMenu" class="modal">
        <h3 id="l-set">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <select id="langSel" onchange="setLang(this.value)">
            <option value="rus">–†—É—Å—Å–∫–∏–π</option>
            <option value="eng">English</option>
            <option value="ukr">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        </select>
        <select onchange="setTheme(this.value)">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="retro">Retro</option>
            <option value="hacker">Hacker (Matrix)</option>
            <option value="snow">Snow (–ó–∏–º–∞)</option>
        </select>
        <button class="btn btn-gold" onclick="openMod('teaWin')" style="width:100%; margin-top:10px;">‚òï –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –º–µ–Ω—è</button>
        <button class="btn btn-orange" onclick="openMod('thanksWin')" style="width:100%; margin-top:10px;">üåü –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏</button>
        <button class="btn btn-red" onclick="logout()" style="width:100%; margin-top:10px;">–í—ã—Ö–æ–¥</button>
        <button class="btn" onclick="closeMod('sMenu')" style="width:100%; margin-top:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="teaWin" class="modal">
        <h3>–ù–∞ —á–∞–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É ‚òï</h3>
        <p>–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è Kiru OS, –º–æ–∂–µ—à—å –∑–∞–∫–∏–Ω—É—Ç—å –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ:</p>
        <b style="font-size: 18px;">+79216274225</b>
        <p>–°–±–µ—Ä–±–∞–Ω–∫ / –°–ë–ü</p>
        <button class="btn" onclick="closeMod('teaWin')" style="width:100%;">–°–ø–∞—Å–∏–±–æ!</button>
    </div>

    <div id="clanWin" class="modal">
        <h3 id="l-clan-title">–°–∏—Å—Ç–µ–º–∞ –ö–ª–∞–Ω–æ–≤</h3>
        <div id="clan-create-box">
            <input type="text" id="cnInp" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞">
            <button class="btn" onclick="createClan()" style="width:100%;">–°–æ–∑–¥–∞—Ç—å (100–∫)</button>
        </div>
        <div id="my-clan-box" style="display:none;">
            <h4 id="curClanName">–ö–ª–∞–Ω: -</h4>
            <div id="clanStats">–ë–∞–Ω–∫: 0</div>
            <div id="clanMembers" style="margin:10px 0;"></div>
            <button class="btn btn-red" onclick="leaveClan()" style="width:100%;">–í—ã–π—Ç–∏ –∏–∑ –∫–ª–∞–Ω–∞</button>
        </div>
        <hr>
        <div id="allClansList"></div>
        <button class="btn" onclick="closeMod('clanWin')" style="width:100%; margin-top:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="pCard" class="modal">
        <h2 id="pc-n">User</h2>
        <div id="pc-stats"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
            <button class="btn" onclick="sendMoney()">–î–æ–Ω–∞—Ç</button>
            <button class="btn btn-orange" onclick="admAction('mute')">Mute</button>
            <button class="btn btn-red" onclick="admAction('reset')">–û–±–Ω—É–ª–∏—Ç—å $</button>
            <button class="btn" onclick="closeMod('pCard')">X</button>
        </div>
    </div>

    <div id="thanksWin" class="modal">
        <h3>Wall of Fame</h3>
        <ul style="list-style:none; padding:0; font-size:14px; line-height:2;">
            <li>–í–∞–¥–µ–∫ (–ì–ª–∞–≤–Ω—ã–π)</li>
            <li>–ê–Ω–∞—Å—Ç–∞—Å–∏—è –ó–µ–º–ª–µ—Ä–æ–π–∫–∞</li>
            <li>–°–∞—à–∞</li>
            <li>–ê–Ω–¥—Ä–µ–πüòé</li>
            <li>–¢–µ–ø–µ</li>
            <li>Gemini AI</li>
            <li id="musyaBtn" style="cursor:pointer; opacity:0.7;">–ú—É—Å—è ‚ù§Ô∏è</li>
        </ul>
        <button class="btn" onclick="closeMod('thanksWin')" style="width:100%;">–ù–∞–∑–∞–¥</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, remove, serverTimestamp, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('k_user_v32'));
        let curLang = 'rus';
        let gid = null, myRole = null, viewUser = null;
        let mClicks = 0;

        const lang = {
            rus: { bal: "–ë–∞–ª–∞–Ω—Å", games: "–ú–∏–Ω–∏-–∏–≥—Ä—ã", chat: "–ß–∞—Ç", set: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", clan: "–ö–ª–∞–Ω—ã", buy: "–ö—É–ø–∏—Ç—å", join: "–í—Å—Ç—É–ø–∏—Ç—å", kick: "–ö–∏–∫" },
            eng: { bal: "Balance", games: "Games", chat: "Chat", set: "Settings", clan: "Clans", buy: "Buy", join: "Join", kick: "Kick" },
            ukr: { bal: "–ë–∞–ª–∞–Ω—Å", games: "–ú—ñ–Ω—ñ-—ñ–≥—Ä–∏", chat: "–ß–∞—Ç", set: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è", clan: "–ö–ª–∞–Ω–∏", buy: "–ö—É–ø–∏—Ç–∏", join: "–í—Å—Ç—É–ø–∏—Ç–∏", kick: "–ö—ñ–∫" }
        };

        async function init() {
            if(!user) {
                let n = prompt("–ù–∏–∫ / Nick:"); let p = prompt("–ü–∞—Ä–æ–ª—å / Pass:");
                if(!n || !p) return location.reload();
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){
                    if(s.val().password !== p) return alert("Wrong pass!"), location.reload();
                    user = {name:n, ...s.val()};
                } else {
                    user = {name:n, password:p, score:0, mult:1, autoclicker:0, wins:0, clicks:0, musyaUsed:false};
                    await set(ref(db, 'users/'+n), user);
                }
                localStorage.setItem('k_user_v32', JSON.stringify(user));
            }

            // Online Status
            const statusRef = ref(db, 'status/' + user.name);
            set(statusRef, true);
            onDisconnect(statusRef).remove();
            onValue(ref(db, 'status'), s => document.getElementById('online-tag').innerText = "‚óè Online: " + (s.size || 0));

            // User Data Sync
            onValue(ref(db, 'users/'+user.name), s => {
                if(s.exists()){
                    user = {name:user.name, ...s.val()};
                    document.getElementById('score').innerText = Math.floor(user.score).toLocaleString();
                    document.getElementById('l-cl-info').innerText = "–ö–ª–∞–Ω: " + (user.clan || "–ù–µ—Ç");
                    checkClanUI();
                }
            });

            loadTop(); loadChat(); loadClans();
            setInterval(() => { if(user.autoclicker > 0) update(ref(db, 'users/'+user.name), {score: Number(user.score) + user.autoclicker}); }, 1000);
        }

        // --- CORE ---
        window.doTap = (e) => {
            let pwr = user.mult || 1;
            let up = { score: Number(user.score) + pwr, clicks: (user.clicks || 0) + 1 };
            update(ref(db, 'users/'+user.name), up);
            
            // Clan Bank Contribution (5%)
            if(user.clan) {
                get(ref(db, 'clans/'+user.clan)).then(s => {
                    if(s.exists()) update(ref(db, 'clans/'+user.clan), { bank: (s.val().bank || 0) + (pwr * 0.05) });
                });
            }
        };

        // --- CLANS ---
        window.createClan = async () => {
            const cn = document.getElementById('cnInp').value.trim();
            if(!cn || user.score < 100000) return alert("Need 100k!");
            await set(ref(db, 'clans/'+cn), { owner: user.name, bank: 0, members: [user.name] });
            await update(ref(db, 'users/'+user.name), { score: user.score - 100000, clan: cn });
        };

        window.joinClan = async (cn) => {
            const s = await get(ref(db, 'clans/'+cn));
            let m = s.val().members || [];
            if(!m.includes(user.name)) {
                m.push(user.name);
                await update(ref(db, 'clans/'+cn), { members: m });
                await update(ref(db, 'users/'+user.name), { clan: cn });
            }
        };

        window.leaveClan = async () => {
            if(!user.clan) return;
            const s = await get(ref(db, 'clans/'+user.clan));
            let m = s.val().members.filter(i => i !== user.name);
            if(s.val().owner === user.name) {
                if(confirm("–í—ã –≤–ª–∞–¥–µ–ª–µ—Ü. –£–¥–∞–ª–∏—Ç—å –∫–ª–∞–Ω?")) {
                    await remove(ref(db, 'clans/'+user.clan));
                    for(let name of s.val().members) update(ref(db, 'users/'+name), {clan:null});
                    return;
                }
            }
            await update(ref(db, 'clans/'+user.clan), { members: m });
            await update(ref(db, 'users/'+user.name), { clan: null });
        };

        function loadClans() {
            onValue(ref(db, 'clans'), s => {
                const l = document.getElementById('allClansList'); l.innerHTML = "<h4>–í—Å–µ –∫–ª–∞–Ω—ã:</h4>";
                s.forEach(d => {
                    l.innerHTML += `<div class="top-item">
                        <span>${d.key} (${d.val().members?.length || 0})</span>
                        <button class="btn" onclick="joinClan('${d.key}')">–í—Å—Ç—É–ø–∏—Ç—å</button>
                    </div>`;
                });
            });
        }

        function checkClanUI() {
            const box = document.getElementById('my-clan-box');
            const create = document.getElementById('clan-create-box');
            if(user.clan) {
                box.style.display = 'block'; create.style.display = 'none';
                document.getElementById('curClanName').innerText = "–ö–ª–∞–Ω: " + user.clan;
                get(ref(db, 'clans/'+user.clan)).then(s => {
                    const d = s.val();
                    document.getElementById('clanStats').innerText = `–ë–∞–Ω–∫: ${Math.floor(d.bank)} üí∞ | –û–≤–Ω–µ—Ä: ${d.owner}`;
                    let mList = document.getElementById('clanMembers'); mList.innerHTML = "–£—á–∞—Å—Ç–Ω–∏–∫–∏:<br>";
                    d.members.forEach(m => {
                        let kickBtn = (d.owner === user.name && m !== user.name) ? `<button onclick="kick('${m}')">X</button>` : '';
                        mList.innerHTML += `<span>${m} ${kickBtn}</span> `;
                    });
                });
            } else {
                box.style.display = 'none'; create.style.display = 'block';
            }
        }

        window.kick = async (m) => {
            const s = await get(ref(db, 'clans/'+user.clan));
            let nm = s.val().members.filter(i => i !== m);
            await update(ref(db, 'clans/'+user.clan), {members: nm});
            await update(ref(db, 'users/'+m), {clan: null});
        };

        // --- GAMES ---
        window.startMM = async (type) => {
            const qRef = ref(db, 'queue_'+type);
            const s = await get(qRef);
            if(s.exists() && s.val() !== user.name) {
                gid = 'game_' + Date.now();
                await set(ref(db, 'games/'+gid), {p1: s.val(), p2: user.name, type, turn: 'p1', board: Array(9).fill(""), active: true});
                await remove(qRef);
                joinGame(gid, 'p2');
            } else {
                set(qRef, user.name);
                document.getElementById('g-status').innerText = "–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞...";
                document.getElementById('lobby').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';
                onValue(ref(db, 'games'), sn => {
                    sn.forEach(g => { if(g.val().p1 === user.name) joinGame(g.key, 'p1'); });
                });
            }
        };

        function joinGame(id, role) {
            gid = id; myRole = role;
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            onValue(ref(db, 'games/'+id), s => {
                const d = s.val(); if(!d) return quitGame();
                document.getElementById('g-status').innerText = (d.turn === myRole) ? "–í–ê–® –•–û–î!" : "–û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ–¥–∞...";
                const bBox = document.getElementById('board-box'); bBox.innerHTML = "";
                const g = document.createElement('div'); g.className = 'grid';
                d.board.forEach((v, i) => {
                    const c = document.createElement('div'); c.className = 'cell'; c.innerText = v;
                    c.onclick = () => {
                        if(d.turn === myRole && v === "") {
                            let nb = [...d.board]; nb[i] = (myRole === 'p1') ? 'X' : 'O';
                            update(ref(db, 'games/'+gid), {board: nb, turn: (myRole === 'p1' ? 'p2' : 'p1')});
                            checkWin(nb, d.p1, d.p2);
                        }
                    };
                    g.appendChild(c);
                });
                bBox.appendChild(g);
            });
        }

        function checkWin(b, p1, p2) {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for(let w of wins) {
                if(b[w[0]] && b[w[0]]===b[w[1]] && b[w[0]]===b[w[2]]) {
                    let winner = b[w[0]]==='X' ? p1 : p2;
                    alert("Winner: " + winner);
                    update(ref(db, 'users/'+winner), {wins: (user.wins||0)+1, score: user.score + 5000});
                    return quitGame();
                }
            }
            if(!b.includes("")) { alert("–ù–∏—á—å—è!"); quitGame(); }
        }

        window.quitGame = () => {
            if(gid) remove(ref(db, 'games/'+gid));
            remove(ref(db, 'queue_ttt')); remove(ref(db, 'queue_chess'));
            gid = null;
            document.getElementById('lobby').style.display = 'flex';
            document.getElementById('game-area').style.display = 'none';
        };

        // --- UI & THEMES ---
        window.setTheme = (t) => {
            document.body.className = 'theme-' + t;
            const canvas = document.getElementById('special-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            if(t === 'hacker') startMatrix(ctx, canvas);
            else if(t === 'snow') startSnow(ctx, canvas);
            else ctx.clearRect(0,0,canvas.width,canvas.height);
        };

        function startMatrix(ctx, c) {
            const chars = "010101ABCDEF".split("");
            const drops = Array(Math.floor(c.width/15)).fill(1);
            setInterval(() => {
                ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = "#0f0"; ctx.font = "15px monospace";
                drops.forEach((y, i) => {
                    const text = chars[Math.floor(Math.random()*chars.length)];
                    ctx.fillText(text, i*15, y*15);
                    if(y*15 > c.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                });
            }, 50);
        }

        function startSnow(ctx, c) {
            const flakes = Array.from({length: 100}, () => ({x: Math.random()*c.width, y: Math.random()*c.height, r: Math.random()*3+1, d: Math.random()*1}));
            setInterval(() => {
                ctx.clearRect(0,0,c.width,c.height);
                ctx.fillStyle = "white"; ctx.beginPath();
                flakes.forEach(f => {
                    ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2, true);
                    f.y += Math.cos(f.d) + 1 + f.r/2; f.x += Math.sin(0)*2;
                    if(f.y > c.height) { f.y = -10; f.x = Math.random()*c.width; }
                });
                ctx.fill();
            }, 30);
        }

        window.setLang = (l) => {
            curLang = l;
            const d = lang[l];
            document.getElementById('l-bal').innerText = d.bal;
            document.getElementById('l-games').innerText = d.games;
            document.getElementById('l-chat').innerText = d.chat;
            document.getElementById('l-set').innerText = d.set;
            document.getElementById('l-clan-title').innerText = d.clan;
        };

        // --- MUSYA & CHAT ---
        document.getElementById('musyaBtn').onclick = () => {
            if(user.musyaUsed) return alert("–ú—É—Å—è —É–∂–µ –ø–æ–º–æ–≥–∞–ª–∞ —Ç–µ–±–µ!");
            mClicks++;
            if(mClicks >= 5) {
                update(ref(db, 'users/'+user.name), {score: user.score + 50000, musyaUsed: true});
                alert("üíñ –ú—É—Å—è –ø–æ–¥–∞—Ä–∏–ª–∞ —Ç–µ–±–µ 50,000 –º–æ–Ω–µ—Ç!");
                mClicks = 0;
            }
        };

        window.sendMsg = async () => {
            const i = document.getElementById('mInp'); if(!i.value.trim()) return;
            const s = await get(ref(db, 'users/'+user.name));
            if(s.val().muteUntil > Date.now()) return alert("Muted!");
            await push(ref(db, 'msgs'), { n: user.name, t: i.value, time: serverTimestamp(), pref: s.val().prefix, col: s.val().color });
            i.value = "";
        };

        function loadChat() {
            onValue(ref(db, 'msgs'), s => {
                const l = document.getElementById('cList'); l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    l.innerHTML += `<div class="msg"><span class="prefix">${m.pref||'USER'}</span><b onclick="showP('${m.n}')">${m.n}</b>: ${m.t}</div>`;
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        window.showP = async n => {
            viewUser = n; const s = await get(ref(db, 'users/'+n)); const d = s.val();
            document.getElementById('pc-n').innerText = n;
            document.getElementById('pc-stats').innerText = `üí∞: ${Math.floor(d.score)} | –ö–ª–∏–∫: ${d.clicks||0} | Wins: ${d.wins||0}`;
            openMod('pCard');
        };

        function loadTop() {
            onValue(ref(db, 'users'), s => {
                const c = document.getElementById('topContent'); c.innerHTML = "";
                let a = []; s.forEach(u => { a.push({n: u.key, s: u.val().score || 0}); });
                a.sort((x,y) => y.s - x.s).slice(0,5).forEach((u,i) => {
                    c.innerHTML += `<div class="top-item"><span>#${i+1} ${u.n}</span><b>${Math.floor(u.s).toLocaleString()}</b></div>`;
                });
            });
        }

        window.admAction = (type) => {
            if(prompt("Admin Pass:") !== "8070") return;
            if(type==='reset') update(ref(db, 'users/'+viewUser), {score: 0});
            if(type==='mute') update(ref(db, 'users/'+viewUser), {muteUntil: Date.now() + 3600000});
        };

        window.logout = () => { localStorage.clear(); location.reload(); };
        window.openMod = id => { document.getElementById(id).style.display='block'; document.getElementById('overlay').style.display='block'; };
        window.closeMod = id => { document.getElementById(id).style.display='none'; document.getElementById('overlay').style.display='none'; };

        init();
    </script>
</body>
</html>










































