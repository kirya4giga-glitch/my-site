
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiru OS v29 - Giga Edition</title>
    <style>
        /* –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –¢–ï–ú–´ */
        :root { --bg: #000; --main: #0A84FF; --glass: rgba(255,255,255,0.1); --txt: #fff; --card: #1c1c1e; }
        body.theme-hacker { --bg: #050505; --main: #32D74B; --txt: #32D74B; --glass: rgba(0,255,0,0.05); }
        body.theme-ios-light { --bg: #F2F2F7; --main: #007AFF; --txt: #000; --glass: rgba(255,255,255,0.8); --card: #fff; }
        body.theme-cyber { --bg: #0d0015; --main: #BF5AF2; --txt: #64D2FF; --glass: rgba(191,90,242,0.1); }

        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 15px; transition: 0.3s; }
        
        /* –ì–õ–ê–í–ù–´–ï –ö–û–ù–¢–ï–ô–ù–ï–†–´ */
        .game-box { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); padding: 20px; border-radius: 25px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        
        .button-tea { padding: 12px 18px; background: var(--main); color: #fff; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; margin: 5px; transition: 0.2s; }
        .button-tea:active { transform: scale(0.95); }

        /* –ß–ê–¢ */
        #cList { height: 300px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 12px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 14px; position: relative; border-left: 3px solid var(--main); animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .msg-time { font-size: 10px; opacity: 0.4; float: right; margin-top: 4px; }
        .del-btn { color: #ff453a; cursor: pointer; float: right; font-weight: bold; margin-left: 10px; }

        /* –¢–û–ü –ò–ì–†–û–ö–û–í (–í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ô) */
        #topContent { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; }
        .top-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .my-score { border: 1px solid var(--main); background: rgba(10, 132, 255, 0.1); }

        /* –ú–ê–ì–ê–ó–ò–ù –ò –ú–û–î–ê–õ–ö–ò */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); padding: 25px; border-radius: 30px; z-index: 3000; width: 85%; max-width: 380px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 50vh; overflow-y: auto; padding: 5px; }
        .shop-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; text-align: center; }

        /* –ò–ì–†–´ */
        .ttt-grid { display: grid; grid-template-columns: repeat(3, 1fr); width: 210px; height: 210px; margin: 10px auto; gap: 5px; }
        .cell { background: #2c2c2e; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
        .hidden { display: none; }
        .prefix { font-size: 10px; padding: 2px 5px; border-radius: 4px; background: #fff; color: #000; font-weight: bold; margin-right: 5px; }
    </style>
</head>
<body class="theme-ios-dark">

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h2 id="h-title" style="margin:0;">Kiru OS v29</h2>
        <div style="display:flex; gap:5px;">
            <button class="button-tea" onclick="openMod('shopWin')">üõí <span id="l-sh-btn">Shop</span></button>
            <button class="button-tea" onclick="openMod('sMenu')">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="game-box" style="text-align:center;">
        <h3 id="l-bal-txt">–ë–∞–ª–∞–Ω—Å</h3>
        <div id="score" style="font-size:60px; font-weight:900; margin:10px 0; color:var(--main);">0</div>
        <button class="button-tea" id="l-tap" onclick="doClick()" style="width:100%; padding:20px; font-size:22px; border-radius:18px;">–¢–ê–ü!</button>
        
        <div style="text-align:left; margin-top:25px;">
            <b id="l-top-h">üèÜ –¢–æ–ø –ª–∏–¥–µ—Ä–æ–≤:</b>
            <div id="topContent">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <div class="game-box">
        <h3 id="l-chat-h">–ß–∞—Ç</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:10px">
            <input type="text" id="mInp" placeholder="..." style="flex:1; background:rgba(255,255,255,0.1); border:none; color:inherit; padding:14px; border-radius:14px; outline:none;">
            <button class="button-tea" id="sendBtn" style="width:60px; font-weight:bold;">></button>
        </div>
    </div>

    <div class="game-box">
        <h3 id="l-games-h">–ò–≥—Ä—ã</h3>
        <div id="lobby" style="display:flex; gap:10px; justify-content:center;">
            <button class="button-tea" onclick="startMM('ttt')">–ö—Ä–µ—Å—Ç–∏–∫–∏</button>
            <button class="button-tea" onclick="startMM('chess')">–®–∞—Ö–º–∞—Ç—ã</button>
        </div>
        <div id="game-area" class="hidden">
            <div id="g-info" style="text-align:center; margin-bottom:10px; font-weight:bold;"></div>
            <div id="board-container"></div>
            <button class="button-tea" onclick="stopMM()" id="l-cancel" style="background:#ff453a; width:100%; margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="shopWin" class="modal">
        <h3 id="l-sh-title">–ú–∞–≥–∞–∑–∏–Ω</h3>
        <div class="shop-grid">
            <div class="shop-card">ü§ñ Auto<br><button class="button-tea" onclick="buy('auto', 5000, 1)">5000</button></div>
            <div class="shop-card">‚ö° Multi<br><button class="button-tea" onclick="buy('multi', 2000, 2)">2000</button></div>
            <div class="shop-card">üíé VIP<br><button class="button-tea" onclick="buy('prefix', 1000, 'VIP')">1000</button></div>
            <div class="shop-card">üëë ELITE<br><button class="button-tea" onclick="buy('prefix', 5000, 'ELITE')">5000</button></div>
            <div class="shop-card">üîµ Blue<br><button class="button-tea" onclick="buy('color', 1500, '#0A84FF')">1500</button></div>
            <div class="shop-card">üõ°Ô∏è Shield<br><button class="button-tea" onclick="buy('item', 2000, 'shield')">2000</button></div>
        </div>
        <button class="button-tea" onclick="closeMod('shopWin')" style="width:100%; margin-top:10px;">Close</button>
    </div>

    <div id="sMenu" class="modal">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        –¢–µ–º–∞: <select onchange="changeTheme(this.value)">
            <option value="ios-dark">iOS Dark</option>
            <option value="hacker">Hacker</option>
            <option value="ios-light">iOS Light</option>
            <option value="cyber">Cyber</option>
        </select><br><br>
        –Ø–∑—ã–∫: <select onchange="changeLang(this.value)">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
            <option value="ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        </select>
        <hr style="opacity:0.1">
        <button class="button-tea" onclick="logout()" style="background:#ff453a; width:100%;">–í—ã—Ö–æ–¥</button>
        <button class="button-tea" onclick="closeMod('sMenu')" style="width:100%; margin-top:10px;">X</button>
    </div>

    <div id="pCard" class="modal">
        <h2 id="pc-name">User</h2>
        <div id="pc-stats" style="text-align:left;"></div>
        <button class="button-tea" onclick="sendMoneyPrompt()">üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
        <button class="button-tea" onclick="adminMute()" style="background:orange">Mute</button>
        <button class="button-tea" onclick="closeMod('pCard')">X</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('user_v29'));
        let selId, gid, myRole, viewUser;

        const langData = {
            ru: {bal:"–ë–∞–ª–∞–Ω—Å", tap:"–¢–ê–ü!", top:"üèÜ –¢–æ–ø –ª–∏–¥–µ—Ä–æ–≤:", chat:"–ß–∞—Ç", games:"–ò–≥—Ä—ã", shbtn:"–ú–∞–≥–∞–∑–∏–Ω", sh:"–ú–∞–≥–∞–∑–∏–Ω", cancel:"–û—Ç–º–µ–Ω–∞"},
            en: {bal:"Balance", tap:"TAP!", top:"üèÜ Leaderboard:", chat:"iChat", games:"Games", shbtn:"Shop", sh:"Market", cancel:"Cancel"},
            ua: {bal:"–ë–∞–ª–∞–Ω—Å", tap:"–¢–ê–ü!", top:"üèÜ –¢–æ–ø –ª—ñ–¥–µ—Ä—ñ–≤:", chat:"–ß–∞—Ç", games:"–Ü–≥—Ä–∏", shbtn:"–ö—Ä–∞–º–Ω–∏—Ü—è", sh:"–ö—Ä–∞–º–Ω–∏—Ü—è", cancel:"–°–∫–∞—Å—É–≤–∞—Ç–∏"}
        };

        window.changeLang = (l) => {
            const d = langData[l];
            document.getElementById('l-bal-txt').innerText = d.bal; document.getElementById('l-tap').innerText = d.tap;
            document.getElementById('l-top-h').innerText = d.top; document.getElementById('l-chat-h').innerText = d.chat;
            document.getElementById('l-games-h').innerText = d.games; document.getElementById('l-sh-btn').innerText = d.shbtn;
            document.getElementById('l-sh-title').innerText = d.sh; document.getElementById('l-cancel').innerText = d.cancel;
        };

        async function init() {
            if(!user) {
                let n = prompt("–ù–∏–∫:"); let p = prompt("–ü–∞—Ä–æ–ª—å:");
                if(!n) return;
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){ if(s.val().password !== p) return location.reload(); user={name:n, ...s.val()}; }
                else { user={name:n, password:p, score:0, mult:1, autoclicker:0}; await set(ref(db, 'users/'+n), user); }
                localStorage.setItem('user_v29', JSON.stringify(user));
            }
            
            onValue(ref(db, 'users/'+user.name), (s) => {
                if(s.exists()) {
                    user = {name: user.name, ...s.val()};
                    document.getElementById('score').innerText = user.score;
                }
            });

            loadChat(); loadTop();
            setInterval(() => { if(user.autoclicker > 0) update(ref(db, 'users/'+user.name), {score: (user.score || 0) + user.autoclicker}); }, 1000);
        }

        window.doClick = () => update(ref(db, 'users/'+user.name), {score: (user.score || 0) + (user.mult || 1)});

        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ß–ê–¢
        const sendMsg = async () => {
            const inp = document.getElementById('mInp');
            if(!inp.value.trim()) return;
            const s = await get(ref(db, 'users/'+user.name));
            if(s.val().muteUntil > Date.now()) return alert("Muted!");
            
            await push(ref(db, 'msgs'), {
                n: user.name, t: inp.value, time: serverTimestamp(),
                pref: s.val().prefix || '', col: s.val().color || ''
            });
            inp.value = "";
        };

        document.getElementById('sendBtn').onclick = sendMsg;
        document.getElementById('mInp').onkeydown = (e) => { if(e.key === 'Enter') sendMsg(); };

        function loadChat() {
            onValue(ref(db, 'msgs'), (s) => {
                const l = document.getElementById('cList'); l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    const date = m.time ? new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "";
                    l.innerHTML += `<div class="msg">
                        <span class="del-btn" onclick="adminDelMsg('${d.key}')">√ó</span>
                        ${m.pref ? `<span class="prefix">${m.pref}</span>`:''}
                        <b style="color:${m.col||'inherit'}" onclick="showP('${m.n}')">${m.n}</b>: ${m.t}
                        <span class="msg-time">${date}</span>
                    </div>`;
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        function loadTop() {
            onValue(ref(db, 'users'), (s) => {
                const cont = document.getElementById('topContent'); cont.innerHTML = "";
                let players = [];
                s.forEach(u => { players.push({n: u.key, s: u.val().score || 0}); });
                players.sort((a,b) => b.s - a.s).slice(0, 10).forEach((p, i) => {
                    const isMe = p.n === user.name ? 'my-score' : '';
                    cont.innerHTML += `<div class="top-row ${isMe}">
                        <span><b>#${i+1}</b> ${p.n}</span>
                        <span><b>${p.s}</b> üí∞</span>
                    </div>`;
                });
            });
        }

        window.buy = async (type, price, val) => {
            if(user.score < price) return alert("Low üí∞");
            let up = { score: user.score - price };
            if(type==='auto') up.autoclicker = (user.autoclicker||0)+val;
            if(type==='multi') up.mult = (user.mult||1)+val;
            if(type==='prefix') up.prefix = val;
            if(type==='color') up.color = val;
            await update(ref(db, 'users/'+user.name), up);
            alert("–ö—É–ø–ª–µ–Ω–æ!");
        };

        window.startMM = async (type) => {
            const qRef = ref(db, 'queue_'+type); const snap = await get(qRef);
            if(snap.exists() && snap.val() !== user.name) {
                gid = 'g_'+Date.now();
                await set(ref(db, 'games/'+gid), { p1: snap.val(), p2: user.name, type, turn: 'p1', board: type==='ttt' ? Array(9).fill("") : "rnbqkbnrpppppppp................................PPPPPPPPRNBQKBNR" });
                await remove(qRef); join(gid, 'p2');
            } else { set(qRef, user.name); onValue(ref(db, 'games'), (s) => { s.forEach(g => { if(g.val().p1 === user.name) join(g.key, 'p1'); }); }); }
        };

        function join(id, role) {
            gid = id; myRole = role; document.getElementById('lobby').classList.add('hidden'); document.getElementById('game-area').classList.remove('hidden');
            onValue(ref(db, 'games/'+id), (s) => {
                const d = s.val(); if(!d) return; const cont = document.getElementById('board-container'); cont.innerHTML = "";
                const board = document.createElement('div'); board.className = d.type==='ttt'?'ttt-grid':'chess-board';
                const bArr = Array.isArray(d.board) ? d.board : d.board.split('');
                bArr.forEach((v, i) => {
                    const c = document.createElement('div'); c.className = 'cell';
                    c.innerText = v;
                    c.onclick = () => {
                        if(d.turn !== (myRole==='p1'?'p1':'p2')) return;
                        let nb = [...bArr];
                        if(d.type==='ttt'){ if(nb[i]!=='')return; nb[i]=myRole==='p1'?'X':'O'; }
                        update(ref(db, 'games/'+gid), {board: nb, turn: d.turn==='p1'?'p2':'p1'});
                    };
                    board.appendChild(c);
                });
                cont.appendChild(board);
                document.getElementById('g-info').innerText = d.turn === (role==='p1'?'p1':'p2') ? "–¢–í–û–ô –•–û–î" : "–ñ–î–ò...";
            });
        }

        window.showP = async (n) => {
            viewUser = n; const s = await get(ref(db, 'users/'+n)); const d = s.val();
            document.getElementById('pc-name').innerText = n;
            document.getElementById('pc-stats').innerHTML = `üí∞ Score: ${d.score}<br>ü§ñ Auto: ${d.autoclicker||0}`;
            openMod('pCard');
        };

        window.adminDelMsg = (id) => { if(prompt("Pass:")==="8070") remove(ref(db, 'msgs/'+id)); };
        window.openMod = (id) => document.getElementById(id).style.display = 'block';
        window.closeMod = (id) => document.getElementById(id).style.display = 'none';
        window.changeTheme = (v) => document.body.className = 'theme-'+v;
        window.logout = () => { localStorage.clear(); location.reload(); };

        init();
    </script>
</body>
</html>






























