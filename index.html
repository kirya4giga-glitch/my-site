<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super App v21 - Economic System</title>
    <style>
        :root { --bg: #0a0a0a; --main: #0F0; --box: rgba(15, 30, 15, 0.9); --txt: #0F0; }
        body.theme-tg { --bg: #17212b; --main: #5288c1; --box: #242f3d; --txt: #fff; }
        body.theme-snow { --bg: #001c3d; --main: #ffffff; --box: rgba(255,255,255,0.1); --txt: #fff; }
        body.theme-cyber { --bg: #0d0015; --main: #ff00ff; --box: #1a0029; --txt: #00ffff; }
        
        body { font-family: 'Consolas', monospace; text-align: center; padding: 20px; background: var(--bg); color: var(--txt); margin: 0; transition: 0.3s; overflow-x: hidden; }
        .game-box { background: var(--box); padding: 15px; border-radius: 15px; display: inline-block; margin-bottom: 20px; width: 95%; max-width: 450px; border: 1px solid var(--main); position: relative; z-index: 5; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .button-tea { padding: 8px 15px; background: transparent; color: var(--main); border: 1px solid var(--main); border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px; }
        
        #cList { height: 250px; overflow-y: auto; background: rgba(0,0,0,0.4); border-radius: 10px; padding: 10px; margin-bottom: 10px; text-align: left; border: 1px solid var(--main); }
        .msg { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px; position: relative; border-left: 3px solid var(--main); cursor: pointer; }
        .msg-time { position: absolute; bottom: 5px; right: 10px; font-size: 10px; opacity: 0.5; }
        
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--box); border: 2px solid var(--main); padding: 25px; border-radius: 15px; z-index: 2000; width: 320px; box-shadow: 0 0 50px #000; max-height: 80vh; overflow-y: auto; }
        
        .shop-item { border-bottom: 1px solid var(--main); padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .prefix { font-size: 10px; padding: 2px 4px; border-radius: 4px; margin-right: 5px; background: var(--main); color: #000; font-weight: bold; }
        
        .top-del { color: #ff4d4d; font-size: 9px; cursor: pointer; margin-left: 5px; }
        .top-mute { color: #ffa500; font-size: 9px; cursor: pointer; margin-left: 5px; }
        
        .chess-board, .ttt-grid { display: grid; margin: 10px auto; border: 1px solid var(--main); background: #000; }
        .chess-board { grid-template-columns: repeat(8, 1fr); width: 280px; height: 280px; }
        .ttt-grid { grid-template-columns: repeat(3, 1fr); width: 210px; height: 210px; }
        .cell { display: flex; align-items: center; justify-content: center; border: 0.1px solid #333; cursor: pointer; font-size: 20px; }
        
        #matrixCanvas, #snowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        #reactPicker { display: none; position: fixed; background: #111; border: 1px solid var(--main); padding: 10px; border-radius: 50px; z-index: 3000; gap: 10px; font-size: 24px; }
        .hidden { display: none; }
    </style>
</head>
<body class="theme-hacker">
    <canvas id="matrixCanvas"></canvas>
    <canvas id="snowCanvas" class="hidden"></canvas>

    <div style="position:fixed; top:15px; right:15px; z-index:1001; display:flex; gap:10px;">
        <button class="button-tea" onclick="openMod('shopWin')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="button-tea" onclick="openMod('sMenu')">‚öôÔ∏è</button>
    </div>

    <h1>Kiru Economy v21</h1>
    <h3>–¢–≤–æ–π –±–∞–ª–∞–Ω—Å: <span id="userBalance">0</span> üí∞</h3>

    <div id="shopWin" class="modal">
        <h3>üõí Market</h3>
        <div class="shop-item">
            <span>[VIP] –ü—Ä–µ—Ñ–∏–∫—Å</span>
            <button class="button-tea" onclick="buy('prefix', 100, 'VIP')">100 üí∞</button>
        </div>
        <div class="shop-item">
            <span>[ELITE] –°—Ç–∞—Ç—É—Å</span>
            <button class="button-tea" onclick="buy('prefix', 500, 'ELITE')">500 üí∞</button>
        </div>
        <div class="shop-item">
            <span>üé® –°–∏–Ω–∏–π –Ω–∏–∫</span>
            <button class="button-tea" onclick="buy('color', 300, '#00F')">300 üí∞</button>
        </div>
        <div class="shop-item">
            <span>üõ°Ô∏è –ê–Ω—Ç–∏-–ú—É—Ç (1 —Ä–∞–∑)</span>
            <button class="button-tea" onclick="buy('item', 1000, 'shield')">1000 üí∞</button>
        </div>
        <button class="button-tea" onclick="closeMod('shopWin')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="pCard" class="modal">
        <h2 id="pc-name">–ò–≥—Ä–æ–∫</h2>
        <div id="pc-stats" style="text-align:left; font-size: 14px;"></div>
        <hr>
        <div id="admin-actions">
            <button class="button-tea" onclick="sendMoneyPrompt()" style="color:gold; border-color:gold">üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</button>
            <button class="button-tea" onclick="resetScore()" style="color:red; border-color:red">–°–±—Ä–æ—Å –∫–ª–∏–∫–æ–≤</button>
        </div>
        <button class="button-tea" onclick="closeMod('pCard')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="sMenu" class="modal">
        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        –¢–µ–º–∞: <select onchange="changeTheme(this.value)"><option value="hacker">Hacker</option><option value="tg">Telegram</option><option value="snow">Snow</option><option value="cyber">Cyber</option></select>
        <hr>
        <h4>üôè –û—Å–æ–±–∞—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å:</h4>
        <p style="font-size: 12px; color: yellow;">–ë—É–¥—É—â–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É (–∞–≤—Ç–æ—Ä—É)<br>–ú—É—Å–µ ‚ù§Ô∏è<br>–í—Å–µ–º —Ç–µ—Å—Ç–µ—Ä–∞–º v21</p>
        <button class="button-tea" onclick="alert('–ß–∞–π –∞–≤—Ç–æ—Ä—É: +79216274225')">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</button>
        <button class="button-tea" onclick="logout()">–í—ã—Ö–æ–¥</button>
        <button class="button-tea" onclick="closeMod('sMenu')">X</button>
    </div>

    <div class="game-box">
        <h3>–ß–∞—Ç</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:5px">
            <input type="text" id="mInp" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; background:transparent; border:1px solid var(--main); color:inherit; padding:10px; border-radius:8px">
            <button class="button-tea" onclick="sendMsg()">></button>
        </div>
    </div>

    <div class="game-box">
        <h3>–§–µ—Ä–º–∞ –∫–æ–∏–Ω–æ–≤</h3>
        <div id="score" style="font-size:45px; font-weight:bold">0</div>
        <button class="button-tea" onclick="doClick()" style="padding:15px 35px; font-size:20px">–ú–ê–ô–ù–ò–¢–¨ (–ö–õ–ò–ö!)</button>
        <div id="topList" style="text-align:left; font-size:13px; margin-top:10px; border-top:1px solid var(--main); padding-top:10px"></div>
    </div>

    <div id="reactPicker">
        <span onclick="applyR('üî•')">üî•</span><span onclick="applyR('‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span onclick="applyR('üëç')">üëç</span><span onclick="applyR('üòÇ')">üòÇ</span><span onclick="applyR('üíÄ')">üíÄ</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, remove, off, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('user_v21'));
        let selId = null, viewUser = null;

        async function init() {
            if(!user) {
                let n = prompt("–ò–º—è:"); if(!n) return;
                let p = prompt("–ü–∞—Ä–æ–ª—å:");
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){ if(s.val().password !== p) return location.reload(); user = {name: n, ...s.val()}; }
                else { user = {name: n, password: p, score: 0, prefix: '', color: '', shield: 0}; await set(ref(db, 'users/'+n), user); }
                localStorage.setItem('user_v21', JSON.stringify(user));
            }
            syncUser(); loadTop(); loadChat();
        }

        async function syncUser() {
            onValue(ref(db, 'users/'+user.name), (s) => {
                const d = s.val(); if(!d) return;
                user = {name: user.name, ...d};
                document.getElementById('userBalance').innerText = d.score;
                document.getElementById('score').innerText = d.score;
                localStorage.setItem('user_v21', JSON.stringify(user));
            });
        }

        window.doClick = () => {
            update(ref(db, 'users/'+user.name), {score: user.score + 1});
        };

        window.sendMsg = async () => {
            const i = document.getElementById('mInp'); if(!i.value) return;
            const s = await get(ref(db, 'users/'+user.name));
            if(s.val().muteUntil > Date.now()) return alert("–í—ã –≤ –º—É—Ç–µ!");
            push(ref(db, 'msgs'), {
                n: user.name, 
                t: i.value, 
                time: serverTimestamp(),
                pref: s.val().prefix || '',
                col: s.val().color || ''
            });
            i.value="";
        };

        function loadChat() {
            onValue(ref(db, 'msgs'), (s) => {
                const l = document.getElementById('cList'); l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    const date = m.time ? new Date(m.time) : new Date();
                    const ts = date.getHours().toString().padStart(2,'0') + ":" + date.getMinutes().toString().padStart(2,'0');
                    const div = document.createElement('div'); div.className = 'msg';
                    const pfx = m.pref ? `<span class="prefix">${m.pref}</span>` : "";
                    div.innerHTML = `
                        <span class="del-btn" onclick="event.stopPropagation(); delM('${d.key}')">X</span>
                        ${pfx}<b style="color:${m.col || 'inherit'}" onclick="event.stopPropagation(); showP('${m.n}')">${m.n}</b>: ${m.t}
                        <span class="msg-time">${ts}</span>
                    `;
                    div.onclick = (e) => { selId = d.key; const p = document.getElementById('reactPicker'); p.style.display='flex'; p.style.top=(e.clientY-40)+'px'; p.style.left=e.clientX+'px'; };
                    l.appendChild(div);
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        window.buy = async (type, price, val) => {
            if(user.score < price) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤!");
            const up = { score: user.score - price };
            if(type === 'prefix') up.prefix = val;
            if(type === 'color') up.color = val;
            if(type === 'item') up.shield = (user.shield || 0) + 1;
            
            await update(ref(db, 'users/'+user.name), up);
            push(ref(db, 'msgs'), {n: '–°–ò–°–¢–ï–ú–ê', t: `üéâ ${user.name} –∫—É–ø–∏–ª ${val}!`, time: serverTimestamp()});
            alert("–£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞!");
        };

        window.sendMoneyPrompt = async () => {
            let target = viewUser;
            let amount = parseInt(prompt(`–°–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ ${target}? (–ö–æ–º–∏—Å—Å–∏—è 5%)`));
            if(isNaN(amount) || amount <= 0 || amount > user.score) return alert("–û—à–∏–±–∫–∞ —Å—É–º–º—ã!");
            
            const tax = Math.ceil(amount * 0.05);
            const final = amount - tax;

            const tSnap = await get(ref(db, 'users/'+target));
            if(!tSnap.exists()) return;

            await update(ref(db, 'users/'+user.name), { score: user.score - amount });
            await update(ref(db, 'users/'+target), { score: (tSnap.val().score || 0) + final });

            push(ref(db, 'msgs'), {n: '–ë–ê–ù–ö', t: `üí∏ ${user.name} –ø–µ—Ä–µ–≤–µ–ª ${target} ${final} –∫–æ–∏–Ω–æ–≤ (–Ω–∞–ª–æ–≥ ${tax} —Å–æ–∂–∂–µ–Ω)`, time: serverTimestamp()});
            closeMod('pCard');
        };

        window.toggleMute = async (name) => {
            const s = await get(ref(db, 'users/'+name));
            if(s.val().shield > 0) {
                await update(ref(db, 'users/'+name), { shield: s.val().shield - 1 });
                return alert("–£ –∏–≥—Ä–æ–∫–∞ –±—ã–ª –©–ò–¢! –ú—É—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω, —â–∏—Ç —Å–ª–æ–º–∞–Ω.");
            }
            let m = prompt("–ú–∏–Ω—É—Ç—ã:");
            if(m && prompt("–ê–¥–º–∏–Ω-–∫–æ–¥:") === "8070") {
                update(ref(db, 'users/'+name), { muteUntil: Date.now() + (m * 60000) });
            }
        };

        window.showP = async (n) => {
            viewUser = n;
            const s = await get(ref(db, 'users/'+n)); const d = s.val();
            document.getElementById('pc-name').innerText = (d.prefix ? `[${d.prefix}] ` : "") + n;
            document.getElementById('pc-stats').innerHTML = `
                üí∞ –ë–∞–ª–∞–Ω—Å: <b>${d.score}</b><br>
                üõ°Ô∏è –ó–∞—â–∏—Ç–∞: <b>${d.shield || 0}</b><br>
                ü§ê –°—Ç–∞—Ç—É—Å: <b>${d.muteUntil > Date.now() ? "–í –ú–£–¢–ï" : "–°–í–û–ë–û–î–ï–ù"}</b>
            `;
            openMod('pCard');
        };

        window.loadTop = () => {
            onValue(ref(db, 'users'), (s) => {
                const t = document.getElementById('topList'); t.innerHTML = "<b>–¢–û–ü –ë–û–ì–ê–ß–ï–ô:</b><br>";
                let a = []; s.forEach(u => a.push({n:u.key, s:u.val().score || 0, m:u.val().muteUntil}));
                a.sort((x,y) => y.s - x.s).slice(0, 10).forEach((u,i) => {
                    t.innerHTML += `<div style="margin-bottom:5px">
                        <span onclick="showP('${u.n}')" style="cursor:pointer">${i+1}. ${u.n} ‚Äî <b>${u.s}</b></span>
                        <span class="top-mute" onclick="toggleMute('${u.n}')">ü§ê</span>
                        <span class="top-del" onclick="delUser('${u.n}')">[X]</span>
                    </div>`;
                });
            });
        };

        window.delM = (id) => { if(prompt("Pass:") === "8070") remove(ref(db, 'msgs/'+id)); };
        window.delUser = (name) => { if(prompt("Admin Pass:") === "8070") remove(ref(db, 'users/'+name)); };
        window.openMod = (id) => document.getElementById(id).style.display = 'block';
        window.closeMod = (id) => document.getElementById(id).style.display = 'none';
        window.logout = () => { localStorage.clear(); location.reload(); };
        window.changeTheme = (v) => { document.body.className = 'theme-'+v; };
        
        init();
        window.onclick = (e) => { if(!e.target.closest('.msg')) document.getElementById('reactPicker').style.display='none'; };
    </script>
</body>
</html>



















