<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiru OS v30.4 - MEGA UPDATE</title>
    <style>
        :root { 
            --bg: #000; --main: #0A84FF; --txt: #fff; 
            --glass: rgba(255, 255, 255, 0.08); 
            --card: rgba(28, 28, 30, 0.8);
            --red: #FF453A; --green: #32D74B; --orange: #FF9F0A;
        }
        body.theme-hacker { --bg: #000; --main: #32D74B; --txt: #32D74B; --glass: rgba(0,255,0,0.05); }
        body.theme-ios-light { --bg: #F2F2F7; --main: #007AFF; --txt: #000; --glass: rgba(255, 255, 255, 0.7); --card: rgba(255,255,255,0.9); }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: var(--txt); margin: 0; padding: 15px; 
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); -webkit-font-smoothing: antialiased;
        }

        .ios-card { 
            background: var(--glass); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .btn { 
            padding: 12px 16px; background: var(--main); color: #fff; border: none; 
            border-radius: 14px; cursor: pointer; font-weight: 600; font-size: 15px;
            transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.92); opacity: 0.8; }
        .btn-red { background: var(--red); }
        .btn-orange { background: var(--orange); }

        #cList { height: 280px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
        .msg { 
            background: rgba(255,255,255,0.06); padding: 12px; border-radius: 18px; 
            font-size: 14px; border-left: 4px solid var(--main); animation: pop 0.3s ease-out;
            position: relative;
        }
        .msg-time { font-size: 9px; opacity: 0.4; float: right; margin-top: 5px; }
        .msg-del { position: absolute; right: 10px; top: 10px; color: var(--red); cursor: pointer; font-weight: bold; font-size: 16px; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .top-list { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; }
        .top-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 16px; background: rgba(255,255,255,0.04); border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .my-rank { border: 1.5px solid var(--main); background: rgba(10,132,255,0.15); }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; width: 240px; margin: 15px auto; }
        .cell { background: rgba(255,255,255,0.1); border-radius: 12px; height: 75px; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; cursor: pointer; }

        .modal { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--card); backdrop-filter: blur(50px); border-radius: 32px;
            width: 88%; max-width: 380px; z-index: 9999; padding: 25px; border: 1px solid rgba(255,255,255,0.15);
        }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9998; }
        .prefix { font-size: 10px; font-weight: 800; padding: 2px 6px; border-radius: 6px; margin-right: 6px; text-transform: uppercase; background: #fff; color: #000; }
        input { background: rgba(255,255,255,0.08); border: none; padding: 14px; border-radius: 14px; color: #fff; font-size: 16px; outline: none; }
        .hidden { display: none; }
    </style>
</head>
<body class="theme-ios-dark">

    <div class="overlay" id="overlay"></div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding: 0 5px;">
        <div>
            <h1 style="margin:0; font-size: 24px; font-weight: 800;">Kiru OS <span style="color:var(--main)">v30.4</span></h1>
            <div style="font-size: 10px; opacity: 0.5;">‚óè –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</div>
        </div>
        <div style="display:flex; gap:8px;">
            <button class="btn" onclick="openMod('shopWin')">üõí</button>
            <button class="btn" onclick="openMod('sMenu')">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="ios-card" style="text-align:center;">
        <div style="opacity: 0.6; font-size: 14px; font-weight: 600;" id="l-bal">–ë–∞–ª–∞–Ω—Å</div>
        <div id="score" style="font-size: 56px; font-weight: 900; letter-spacing: -2px; margin: 5px 0;">0</div>
        <button class="btn" id="l-tap" onclick="doClick()" style="width:100%; padding:20px; font-size:18px; border-radius:20px; box-shadow: 0 10px 20px rgba(10,132,255,0.3);">–¢–ê–ü –¢–ê–ü –¢–ê–ü</button>
        
        <div class="top-list" id="topContent"></div>
    </div>

    <div class="ios-card">
        <h3 style="margin-top:0; font-size: 18px;" id="l-chat">iChat Global</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="mInp" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1;">
            <button class="btn" id="sendBtn" style="width:50px;">‚Üí</button>
        </div>
    </div>

    <div class="ios-card">
        <h3 id="l-games">–ê—Ä–∫–∞–¥—ã</h3>
        <div id="lobby" style="display:flex; gap:10px;">
            <button class="btn" onclick="startMM('ttt')" style="flex:1;">Tic-Tac-Toe</button>
            <button class="btn" onclick="startMM('chess')" style="flex:1;">Chess</button>
        </div>
        <div id="game-area" class="hidden">
            <div id="g-info" style="text-align:center; font-weight: 700; color: var(--main); margin-bottom:10px;"></div>
            <div id="board-container"></div>
            <button class="btn btn-red" onclick="stopMM()" id="l-cancel" style="width:100%; margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="shopWin" class="modal">
        <h2 id="l-sh-title">Market</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; max-height:50vh; overflow-y:auto;">
            <div class="top-item" style="flex-direction:column;">ü§ñ Auto +1<button class="btn" onclick="buy('auto', 5000, 1)">5k</button></div>
            <div class="top-item" style="flex-direction:column;">‚ö° Mult +2<button class="btn" onclick="buy('multi', 2000, 2)">2k</button></div>
            <div class="top-item" style="flex-direction:column;">üè≠ Factory +50<button class="btn" onclick="buy('auto', 100000, 50)">100k</button></div>
            <div class="top-item" style="flex-direction:column;">üöÄ Turbo +10<button class="btn" onclick="buy('multi', 50000, 10)">50k</button></div>
            <div class="top-item" style="flex-direction:column;">üíé [VIP]<button class="btn" onclick="buy('prefix', 1500, 'VIP')">1.5k</button></div>
            <div class="top-item" style="flex-direction:column;">üî• [HACKER]<button class="btn" onclick="buy('prefix', 50000, 'HACKER')">50k</button></div>
            <div class="top-item" style="flex-direction:column;">üåô Night Name<button class="btn" onclick="buy('color', 10000, '#A855F7')">10k</button></div>
            <div class="top-item" style="flex-direction:column;">üëë [OWNER]<button class="btn" onclick="buy('prefix', 500000, 'OWNER')">500k</button></div>
        </div>
        <button class="btn" onclick="closeMod('shopWin')" style="width:100%; margin-top:15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="sMenu" class="modal">
        <h3 id="l-set">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <label>–¢–µ–º–∞:</label> <select id="tSel" onchange="changeTheme(this.value)"><option value="ios-dark">Dark</option><option value="ios-light">Light</option><option value="hacker">Hacker</option></select><br><br>
        <label>–Ø–∑—ã–∫:</label> <select id="lSel" onchange="changeLang(this.value)"><option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="en">English</option></select>
        <hr style="opacity:0.1; margin:15px 0;">
        <button class="btn btn-orange" onclick="openMod('thanksWin')" style="width:100%;">üåü –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏</button>
        <button class="btn btn-red" onclick="resetItems()" style="width:100%; margin-top:8px;">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è</button>
        <button class="btn btn-red" onclick="logout()" style="width:100%; margin-top:8px;">–í—ã—Ö–æ–¥</button>
        <button class="btn" onclick="closeMod('sMenu')" style="width:100%; margin-top:10px;">X</button>
    </div>

    <div id="thanksWin" class="modal">
        <h3>Wall of Fame</h3>
        <ul style="text-align:left; font-size:15px; line-height:1.8; list-style:none; padding:0;">
            <li>–í–∞–¥–µ–∫</li>
            <li id="musyaEaster" style="cursor:pointer; font-weight:bold;">–ú—É—Å—è ‚ù§Ô∏è</li>
            <li>–ê–Ω–∞—Å—Ç–∞—Å–∏—è –ó–µ–º–ª–µ—Ä–æ–π–∫–∞</li>
            <li>–°–∞—à–∞</li>
            <li>–ê–Ω–¥—Ä–µ–πüòé</li>
            <li>–¢–µ–ø–µ</li>
            <li>Gemini</li>
        </ul>
        <button class="btn" onclick="closeMod('thanksWin')" style="width:100%;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="pCard" class="modal">
        <h2 id="pc-name">User</h2>
        <div id="pc-stats" style="margin-bottom:15px; font-size:14px; opacity:0.8;"></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button class="btn" onclick="sendMoney()" id="l-send">üí∏ –î–æ–Ω–∞—Ç</button>
            <button class="btn btn-orange" onclick="adminMute()">Mute</button>
            <button class="btn btn-orange" onclick="adminUnmute()">Unmute</button>
            <button class="btn btn-red" onclick="adminResetMoney()">–û–±–Ω—É–ª–∏—Ç—å $</button>
            <button class="btn" onclick="closeMod('pCard')">X</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('k_user_v30'));
        let gid, myRole, viewUser;
        let mClicks = 0;
        let musyaClaimed = false; // –§–ò–ö–°: –ß—Ç–æ–±—ã –¥–∞–≤–∞–ª–∞ –æ–¥–∏–Ω —Ä–∞–∑

        const langData = {
            ru: {bal:"–ë–∞–ª–∞–Ω—Å", chat:"–ß–∞—Ç", games:"–ò–≥—Ä—ã", tap:"–¢–ê–ü –¢–ê–ü –¢–ê–ü", set:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏", sh:"–ú–∞–≥–∞–∑–∏–Ω", send:"–ü–µ—Ä–µ–≤–µ—Å—Ç–∏", del:"–£–¥–∞–ª–∏—Ç—å", cancel:"–û—Ç–º–µ–Ω–∞"},
            en: {bal:"Balance", chat:"iChat", games:"Arcade", tap:"TAP TAP TAP", set:"Settings", sh:"Market", send:"Transfer", del:"Delete", cancel:"Cancel"}
        };

        window.changeLang = (l) => {
            const d = langData[l];
            document.getElementById('l-bal').innerText = d.bal; document.getElementById('l-chat').innerText = d.chat;
            document.getElementById('l-games').innerText = d.games; document.getElementById('l-tap').innerText = d.tap;
            document.getElementById('l-set').innerText = d.set; document.getElementById('l-sh-title').innerText = d.sh;
            document.getElementById('l-send').innerText = d.send; document.getElementById('l-cancel').innerText = d.cancel;
        };

        async function init() {
            if(!user) {
                let n = prompt("–ù–∏–∫:"); let p = prompt("–ü–∞—Ä–æ–ª—å:");
                if(!n || !p) return;
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){ if(s.val().password !== p) return location.reload(); user={name:n, ...s.val()}; }
                else { user={name:n, password:p, score:0, mult:1, autoclicker:0, prefix:''}; await set(ref(db, 'users/'+n), user); }
                localStorage.setItem('k_user_v30', JSON.stringify(user));
            }
            onValue(ref(db, 'users/'+user.name), s => { if(s.exists()){ user = {name:user.name, ...s.val()}; document.getElementById('score').innerText = user.score; }});
            loadChat(); loadTop();
            setInterval(() => { if(user.autoclicker > 0) update(ref(db, 'users/'+user.name), {score: (Number(user.score) || 0) + user.autoclicker}); }, 1000);
        }

        window.doClick = () => update(ref(db, 'users/'+user.name), {score: (Number(user.score) || 0) + (user.mult || 1)});

        // EASTER EGG FIXED (ONLY ONCE)
        document.getElementById('musyaEaster').onclick = () => {
            if(musyaClaimed) return alert("–ú—É—Å—è —É–∂–µ –¥–∞–ª–∞ —Ç–µ–±–µ –≤—Å—ë, —á—Ç–æ –º–æ–≥–ª–∞ ‚ù§Ô∏è");
            mClicks++;
            if(mClicks === 5) {
                const bonus = 10000;
                update(ref(db, 'users/'+user.name), {score: Number(user.score) + bonus});
                const oldBg = document.body.style.background;
                document.body.style.background = '#ff69b4';
                alert("üíñ –ú—É—Å—è –¥–∞—Ä–∏—Ç —Ç–µ–±–µ 10,000 –∫–æ–∏–Ω–æ–≤! (–ë–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è)");
                setTimeout(() => { document.body.style.background = oldBg; }, 1000);
                musyaClaimed = true; 
                mClicks = 0;
            }
        };

        window.sendMsg = async () => {
            const i = document.getElementById('mInp'); if(!i.value.trim()) return;
            const s = await get(ref(db, 'users/'+user.name));
            if(s.val().muteUntil > Date.now()) return alert("–í—ã –∑–∞–º—É—á–µ–Ω—ã!");
            await push(ref(db, 'msgs'), { n: user.name, t: i.value, time: serverTimestamp(), pref: s.val().prefix, col: s.val().color });
            i.value = "";
        };
        document.getElementById('sendBtn').onclick = sendMsg;
        document.getElementById('mInp').onkeydown = e => { if(e.key==='Enter') sendMsg(); };

        function loadChat() {
            onValue(ref(db, 'msgs'), s => {
                const l = document.getElementById('cList'); l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    const date = m.time ? new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "";
                    l.innerHTML += `<div class="msg">
                        <span class="msg-del" onclick="adminDelMsg('${d.key}')">√ó</span>
                        <span class="prefix" style="background:${m.col||'#fff'}">${m.pref||'USER'}</span>
                        <b onclick="showP('${m.n}')" style="color:${m.col||'inherit'}">${m.n}</b>: ${m.t}
                        <div class="msg-time">${date}</div>
                    </div>`;
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        window.adminDelMsg = (id) => { if(prompt("Pass:")==="8070") remove(ref(db, 'msgs/'+id)); };

        function loadTop() {
            onValue(ref(db, 'users'), s => {
                const c = document.getElementById('topContent'); c.innerHTML = "";
                let a = []; 
                s.forEach(u => { a.push({n: u.key, s: Number(u.val().score) || 0}); });
                a.sort((x,y) => y.s - x.s).slice(0,5).forEach((u,i) => {
                    c.innerHTML += `<div class="top-item ${u.n===user.name?'my-rank':''}"><span>#${i+1} ${u.n}</span><b>${u.s} üí∞</b></div>`;
                });
            });
        }

        window.showP = async n => {
            viewUser = n; const s = await get(ref(db, 'users/'+n)); const d = s.val();
            document.getElementById('pc-name').innerText = n;
            document.getElementById('pc-stats').innerHTML = `üí∞: ${d.score} | ü§ñ: ${d.autoclicker} | ‚ö°: ${d.mult}`;
            openMod('pCard');
        };

        window.sendMoney = async () => {
            let amt = parseInt(prompt("–°—É–º–º–∞:"));
            if(amt > 0 && user.score >= amt) {
                const t = await get(ref(db, 'users/'+viewUser));
                await update(ref(db, 'users/'+user.name), {score: Number(user.score) - amt});
                await update(ref(db, 'users/'+viewUser), {score: (Number(t.val().score)||0) + amt});
                alert("–£—Å–ø–µ—à–Ω–æ!"); closeMod('pCard');
            }
        };

        // ADMIN ACTIONS
        window.adminMute = () => { if(prompt("Pass:")==="8070") update(ref(db, 'users/'+viewUser), {muteUntil: Date.now()+3600000}); };
        window.adminUnmute = () => { if(prompt("Pass:")==="8070") update(ref(db, 'users/'+viewUser), {muteUntil: 0}); };
        window.adminResetMoney = () => { if(prompt("Pass:")==="8070") update(ref(db, 'users/'+viewUser), {score: 0}); };

        window.resetItems = () => {
            if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è? –î–µ–Ω—å–≥–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è.")){
                update(ref(db, 'users/'+user.name), {autoclicker: 0, mult: 1, prefix: '', color: ''});
                alert("–°–±—Ä–æ—à–µ–Ω–æ!");
            }
        };

        window.startMM = async type => {
            const q = ref(db, 'queue_'+type); const s = await get(q);
            if(s.exists() && s.val() !== user.name) {
                gid = 'g_'+Date.now();
                await set(ref(db, 'games/'+gid), {p1: s.val(), p2: user.name, type, turn: 'p1', board: Array(9).fill("")});
                await remove(q); join(gid, 'p2');
            } else { set(q, user.name); document.getElementById('g-info').innerText = "–ü–æ–∏—Å–∫..."; document.getElementById('lobby').classList.add('hidden'); document.getElementById('game-area').classList.remove('hidden'); onValue(ref(db, 'games'), sn => { sn.forEach(g => { if(g.val().p1===user.name) join(g.key, 'p1'); })}); }
        };

        window.stopMM = async () => { await remove(ref(db, 'queue_ttt')); await remove(ref(db, 'queue_chess')); if(gid) await remove(ref(db, 'games/'+gid)); location.reload(); };

        function join(id, role) {
            gid = id; myRole = role; document.getElementById('lobby').classList.add('hidden'); document.getElementById('game-area').classList.remove('hidden');
            onValue(ref(db, 'games/'+id), s => {
                const d = s.val(); if(!d) return;
                const cont = document.getElementById('board-container'); cont.innerHTML = "";
                const board = document.createElement('div'); board.className = 'grid';
                d.board.forEach((v, i) => {
                    const c = document.createElement('div'); c.className = 'cell'; c.innerText = v;
                    c.onclick = () => {
                        if(d.turn===(myRole==='p1'?'p1':'p2') && v==="") {
                            let nb = [...d.board]; nb[i] = myRole==='p1'?'X':'O';
                            update(ref(db, 'games/'+gid), {board: nb, turn: d.turn==='p1'?'p2':'p1'});
                        }
                    };
                    board.appendChild(c);
                });
                cont.appendChild(board);
                document.getElementById('g-info').innerText = d.turn===(role==='p1'?'p1':'p2')?"–í–ê–® –•–û–î":"–û–ñ–ò–î–ê–ù–ò–ï...";
            });
        }

        window.buy = async (t, p, v) => {
            if(user.score < p) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üí∞");
            let up = {score: Number(user.score) - p};
            if(t==='auto') up.autoclicker = (user.autoclicker||0)+v;
            if(t==='multi') up.mult = (user.mult||1)+v;
            if(t==='prefix') { up.prefix = v; if(v==='HACKER') up.color = '#32D74B'; }
            if(t==='color') up.color = v;
            await update(ref(db, 'users/'+user.name), up); alert("–ö—É–ø–ª–µ–Ω–æ!");
        };

        window.openMod = id => { document.getElementById(id).style.display='block'; document.getElementById('overlay').style.display='block'; };
        window.closeMod = id => { document.getElementById(id).style.display='none'; document.getElementById('overlay').style.display='none'; };
        window.changeTheme = v => document.body.className = 'theme-'+v;
        window.logout = () => { localStorage.clear(); location.reload(); };

        init();
    </script>
</body>
</html>






































