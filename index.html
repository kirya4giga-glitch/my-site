<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiru OS v28 - Final Fix</title>
    <style>
        :root { --bg: #000; --main: #0A84FF; --glass: rgba(255,255,255,0.08); --txt: #fff; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 15px; transition: 0.3s; overflow-x: hidden; }
        
        .game-box { background: var(--glass); backdrop-filter: blur(25px); padding: 22px; border-radius: 28px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        
        .button-tea { padding: 14px 20px; background: var(--main); color: #fff; border: none; border-radius: 14px; cursor: pointer; font-weight: 700; transition: 0.2s; }
        .button-tea:active { transform: scale(0.95); }

        #cList { height: 250px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 15px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: rgba(255,255,255,0.06); padding: 10px 15px; border-radius: 18px; border-left: 3px solid var(--main); font-size: 15px; animation: slide 0.2s ease; }
        @keyframes slide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–û–ü (–°–í–ï–†–•–£ –í–ù–ò–ó) */
        #topContent { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .top-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 18px; background: rgba(255,255,255,0.04); border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .top-name { font-weight: 600; display: flex; align-items: center; }
        .top-rank { color: var(--main); margin-right: 10px; font-weight: 800; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1c1c1e; padding: 25px; border-radius: 30px; z-index: 3000; width: 85%; border: 1px solid var(--glass); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1 style="font-weight:800; margin:0;">Kiru OS v28</h1>
        <button class="button-tea" onclick="openMod('sMenu')">‚öôÔ∏è</button>
    </div>

    <div class="game-box" style="text-align:center;">
        <h3>üí∞ <span id="userBalance">0</span></h3>
        <div id="score" style="font-size:60px; font-weight:900; margin:10px 0;">0</div>
        <button class="button-tea" onclick="doClick()" style="width:100%; padding:20px; font-size:20px;">–¢–ê–ü!</button>
        
        <div style="text-align:left; margin-top:30px;">
            <b style="font-size:18px;">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤:</b>
            <div id="topContent">
                </div>
        </div>
    </div>

    <div class="game-box">
        <h3>üí¨ –ß–∞—Ç</h3>
        <div id="cList"></div>
        <div style="display:flex; gap:10px">
            <input type="text" id="mInp" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å..." style="flex:1; background:rgba(255,255,255,0.1); border:none; color:#fff; padding:15px; border-radius:15px; outline:none;">
            <button class="button-tea" id="sendBtn" style="width:50px; font-size:20px;">></button>
        </div>
    </div>

    <div id="sMenu" class="modal">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <button class="button-tea" onclick="logout()" style="background:#ff453a; width:100%;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        <button class="button-tea" onclick="closeMod('sMenu')" style="width:100%; margin-top:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { apiKey: "AIzaSyChSk0gETRBQ391e4BjPqFsKc_dzjBmT58", databaseURL: "https://my-chat-52203-default-rtdb.firebaseio.com", projectId: "my-chat-52203" };
        const db = getDatabase(initializeApp(conf));

        let user = JSON.parse(localStorage.getItem('user_v28'));

        async function init() {
            if(!user) {
                let n = prompt("–ò–º—è:"); let p = prompt("–ü–∞—Ä–æ–ª—å:");
                if(!n || !p) return location.reload();
                const s = await get(ref(db, 'users/'+n));
                if(s.exists()){ if(s.val().password !== p) return location.reload(); user={name:n, ...s.val()}; }
                else { user={name:n, password:p, score:0}; await set(ref(db, 'users/'+n), user); }
                localStorage.setItem('user_v28', JSON.stringify(user));
            }
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞
            onValue(ref(db, 'users/'+user.name), (s) => {
                if(s.exists()) {
                    user.score = s.val().score;
                    document.getElementById('userBalance').innerText = user.score;
                    document.getElementById('score').innerText = user.score;
                }
            });

            loadChat();
            loadTop();
        }

        // –ö–õ–ò–ö–ï–†
        window.doClick = () => {
            const next = (user.score || 0) + 1;
            update(ref(db, 'users/'+user.name), {score: next});
        };

        // –ß–ê–¢ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê)
        const sendMsg = async () => {
            const inp = document.getElementById('mInp');
            if(!inp.value.trim()) return;
            
            const msgData = {
                n: user.name,
                t: inp.value,
                time: serverTimestamp()
            };
            
            await push(ref(db, 'msgs'), msgData);
            inp.value = "";
        };

        // –°–ª—É—à–∞–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ
        document.getElementById('sendBtn').onclick = sendMsg;
        
        // –°–ª—É—à–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ Enter
        document.getElementById('mInp').onkeypress = (e) => {
            if(e.key === 'Enter') sendMsg();
        };

        function loadChat() {
            onValue(ref(db, 'msgs'), (s) => {
                const l = document.getElementById('cList');
                l.innerHTML = "";
                s.forEach(d => {
                    const m = d.val();
                    l.innerHTML += `<div class="msg"><b>${m.n}</b>: ${m.t}</div>`;
                });
                l.scrollTop = l.scrollHeight;
            });
        }

        // –¢–û–ü –ò–ì–†–û–ö–û–í (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –°–ü–ò–°–û–ö)
        function loadTop() {
            onValue(ref(db, 'users'), (s) => {
                const cont = document.getElementById('topContent');
                cont.innerHTML = "";
                let players = [];
                s.forEach(u => { players.push({name: u.key, score: u.val().score || 0}); });
                
                players.sort((a,b) => b.score - a.score).slice(0, 10).forEach((p, i) => {
                    const activeClass = p.name === user.name ? 'border: 1px solid var(--main);' : '';
                    cont.innerHTML += `
                        <div class="top-item" style="${activeClass}">
                            <div class="top-name"><span class="top-rank">#${i+1}</span> ${p.name}</div>
                            <div style="font-weight:bold;">${p.score} üí∞</div>
                        </div>
                    `;
                });
            });
        }

        window.openMod = (id) => document.getElementById(id).style.display = 'block';
        window.closeMod = (id) => document.getElementById(id).style.display = 'none';
        window.logout = () => { localStorage.clear(); location.reload(); };

        init();
    </script>
</body>
</html>





























